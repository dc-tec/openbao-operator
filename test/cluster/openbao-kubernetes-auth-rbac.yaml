# ClusterRoleBinding to grant OpenBao the ability to verify Kubernetes service account tokens
#
# This is required for OpenBao's Kubernetes authentication method to work.
# OpenBao needs to call the Kubernetes TokenReview API to validate service account
# tokens, which requires the system:auth-delegator ClusterRole.
#
# This binding grants the permission to the OpenBaoCluster's service account.
# The service account name follows the pattern: <cluster-name>-serviceaccount
#
# For the openbaocluster-full sample, the service account is:
#   openbaocluster-full-serviceaccount in the openbaocluster-full namespace
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: openbaocluster-full-kubernetes-auth
  labels:
    app.kubernetes.io/name: openbao-operator
    app.kubernetes.io/component: test-cluster
subjects:
  - kind: ServiceAccount
    name: openbaocluster-full-serviceaccount
    namespace: openbaocluster-full
  - kind: ServiceAccount
    name: openbaocluster-full-upgrade-serviceaccount
    namespace: openbaocluster-full
  - kind: ServiceAccount
    name: openbaocluster-full-backup-serviceaccount
    namespace: openbaocluster-full
  - kind: ServiceAccount
    name: openbaocluster-gateway-serviceaccount
    namespace: openbaocluster-gateway
roleRef:
  kind: ClusterRole
  name: system:auth-delegator
  apiGroup: rbac.authorization.k8s.io
